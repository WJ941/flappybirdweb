!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=20)}([function(t,e,i){(function(t){function i(t,e){for(var i=0,s=t.length-1;s>=0;s--){var n=t[s];"."===n?t.splice(s,1):".."===n?(t.splice(s,1),i++):i&&(t.splice(s,1),i--)}if(e)for(;i--;i)t.unshift("..");return t}var s=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,n=function(t){return s.exec(t).slice(1)};function r(t,e){if(t.filter)return t.filter(e);for(var i=[],s=0;s<t.length;s++)e(t[s],s,t)&&i.push(t[s]);return i}e.resolve=function(){for(var e="",s=!1,n=arguments.length-1;n>=-1&&!s;n--){var h=n>=0?arguments[n]:t.cwd();if("string"!=typeof h)throw new TypeError("Arguments to path.resolve must be strings");h&&(e=h+"/"+e,s="/"===h.charAt(0))}return e=i(r(e.split("/"),function(t){return!!t}),!s).join("/"),(s?"/":"")+e||"."},e.normalize=function(t){var s=e.isAbsolute(t),n="/"===h(t,-1);return(t=i(r(t.split("/"),function(t){return!!t}),!s).join("/"))||s||(t="."),t&&n&&(t+="/"),(s?"/":"")+t},e.isAbsolute=function(t){return"/"===t.charAt(0)},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(r(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},e.relative=function(t,i){function s(t){for(var e=0;e<t.length&&""===t[e];e++);for(var i=t.length-1;i>=0&&""===t[i];i--);return e>i?[]:t.slice(e,i-e+1)}t=e.resolve(t).substr(1),i=e.resolve(i).substr(1);for(var n=s(t.split("/")),r=s(i.split("/")),h=Math.min(n.length,r.length),a=h,o=0;o<h;o++)if(n[o]!==r[o]){a=o;break}var c=[];for(o=a;o<n.length;o++)c.push("..");return(c=c.concat(r.slice(a))).join("/")},e.sep="/",e.delimiter=":",e.dirname=function(t){var e=n(t),i=e[0],s=e[1];return i||s?(s&&(s=s.substr(0,s.length-1)),i+s):"."},e.basename=function(t,e){var i=n(t)[2];return e&&i.substr(-1*e.length)===e&&(i=i.substr(0,i.length-e.length)),i},e.extname=function(t){return n(t)[3]};var h="b"==="ab".substr(-1)?function(t,e,i){return t.substr(e,i)}:function(t,e,i){return e<0&&(e=t.length+e),t.substr(e,i)}}).call(this,i(1))},function(t,e){var i,s,n=t.exports={};function r(){throw new Error("setTimeout has not been defined")}function h(){throw new Error("clearTimeout has not been defined")}function a(t){if(i===setTimeout)return setTimeout(t,0);if((i===r||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:r}catch(t){i=r}try{s="function"==typeof clearTimeout?clearTimeout:h}catch(t){s=h}}();var o,c=[],d=!1,l=-1;function u(){d&&o&&(d=!1,o.length?c=o.concat(c):l=-1,c.length&&p())}function p(){if(!d){var t=a(u);d=!0;for(var e=c.length;e;){for(o=c,c=[];++l<e;)o&&o[l].run();l=-1,e=c.length}o=null,d=!1,function(t){if(s===clearTimeout)return clearTimeout(t);if((s===h||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(t);try{s(t)}catch(e){try{return s.call(null,t)}catch(e){return s.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function g(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];c.push(new f(t,e)),1!==c.length||d||a(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=g,n.addListener=g,n.once=g,n.off=g,n.removeListener=g,n.removeAllListeners=g,n.emit=g,n.prependListener=g,n.prependOnceListener=g,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,e,i){t.exports=i.p+"assets/images/3d48e54bd9ecd45c7d2d358e447e9b04.png"},function(t,e,i){t.exports=i.p+"assets/images/5b4feec2fcd1a215c914e0b526efd4d7.png"},function(t,e,i){t.exports=i.p+"assets/images/4291fa68d3f564d788ec523a554000c6.png"},function(t,e,i){t.exports=i.p+"assets/images/b45d30debbb777386c5223788d9699ee.png"},function(t,e,i){t.exports=i.p+"assets/images/29d7e57bf5dcb8929792b34cdfb26603.png"},function(t,e,i){t.exports=i.p+"assets/images/5de8f5092fd42b172a37802596efa53e.png"},function(t,e,i){t.exports=i.p+"assets/images/730f666c69c230d16cf635dcf4c3cb93.png"},function(t,e,i){t.exports=i.p+"assets/images/387bf265a2adcecda88ede3d21aa3e78.png"},function(t,e,i){t.exports=i.p+"assets/images/5bd4248852d83aaafeeada1026982ec3.png"},function(t,e,i){t.exports=i.p+"assets/images/ce56ef3dfe7c038f6b2af2fc3359dbdf.png"},function(t,e,i){t.exports=i.p+"assets/images/85180cb69f8da9ea17ca8ccd77b25249.png"},function(t,e,i){t.exports=i.p+"assets/images/256857010857e72d9d8b2e04d283ecfb.png"},function(t,e,i){t.exports=i.p+"assets/images/0c32e6c93141367fa173392951945246.png"},function(t,e,i){t.exports=i.p+"assets/audio/16436c886c305a4bb2f8aa04e0e00919.wav"},function(t,e,i){t.exports=i.p+"assets/audio/3cf321a7a65534a5abd59dc9aacae746.wav"},function(t,e,i){t.exports=i.p+"assets/audio/e1458a87070cab0b76f245fbcacc334b.wav"},function(t,e,i){t.exports=i.p+"assets/audio/db32166321ae7db58ff660306b04389a.wav"},function(t,e,i){t.exports=i.p+"assets/audio/802e8685100ebd33c49630e01407641e.wav"},function(t,e,i){"use strict";i.r(e);class s{constructor(t){this.game=t,this.canvas=t.canvas,this.ctx=t.ctx,this.elements=[]}addElements(t){this.elements.push(t)}render(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.elements.forEach(t=>t.render())}update(){this.elements.forEach(t=>t.update())}}i(0);const n={},r={background_day:i(2),base:i(3),redbird_downflap:i(4),redbird_midflap:i(5),redbird_upflap:i(6),scoreboard:i(7),pipe_green:i(8),splash:i(9),background_day_fill:i(10),medal_bronze:i(11),medal_silver:i(12),medal_gold:i(13),medal_platinum:i(14)},h={audioDie:i(15),audioHit:i(16),audioPoint:i(17),audioSwoosh:i(18),audioWing:i(19)};Object.keys(r).forEach(t=>{const e=new Image;e.src=r[t],n[t]=e}),Object.keys(h).forEach(t=>{const e=new Audio;e.src=h[t],n[t]=e});var a=n;var o={SCORE_Y:80,OVER_TITLE_Y:80,BG_SPEED_X:2,PIEP_SPEED_X:1,PIPE_MIN_HEIGHT:300,PIPE_MAX_HEIGHT:400,PIPE_SPACE_HEIGHT:100,PIPE_SPACE_WIDTH:150};const c=288,d=512,l=112,u=100,p=288;let f=null;class g{constructor(t){if(f)return f;f=this,this.screenWidth=t.canvas.width,this.screenHeight=t.canvas.height,this.img=a.background_day,this.scene=t,this.left=0,this.speed=o.BG_SPEED_X,this.render()}update(){this.left-=this.speed,this.left<=-c&&(this.left=this.left+c)}render(){const t=this.img.complete,e=this.scene.ctx,i=()=>{let t=Math.ceil(1+this.screenWidth/c);for(let i=0;i<t;i++)e.drawImage(this.img,this.left+i*c,0);let i=this.screenHeight-d-l;const s=a.background_day_fill;let n=0;for(;i>0;){const t=Math.ceil(this.screenWidth/p);for(let i=0;i<t;i++)e.drawImage(s,i*p,d+n*u);n++,i-=u}};t?i():this.img.onload=(()=>{i()})}}const m=112,b=336;let w=null;class v{constructor(t){if(this.instance)return w;w=this,this.img=a.base,this.scene=t,this.screenWidth=t.canvas.width,this.screenHeight=t.canvas.height,this.left=0,this.speed=o.BG_SPEED_X,this.render()}update(){if(this.left-=this.speed,this.left<=-b){const t=this.left+b;this.left=t}}render(){const t=this.img.complete,e=this.scene.ctx,i=this.screenHeight-m,s=()=>{e.drawImage(this.img,this.left,i),e.drawImage(this.img,this.left+b,i),e.drawImage(this.img,this.left+2*b,i)};t?s():this.img.onload=(()=>{s()})}}let y=null;class x{constructor(t){if(y)return y;this.ctx=t.ctx,this.screenWidth=t.canvas.width,this.screenHeight=t.canvas.height,y=this,this.init()}init(){this.img=a.splash,this.img.onload=(()=>{const t=this.img.width,e=this.img.height;this.btnArea={startX:(this.screenWidth-t)/2,startY:(this.screenHeight-e)/2,endX:(this.screenWidth+t)/2,endY:(this.screenHeight+e)/2}})}render(){this.img.complete&&this.ctx.drawImage(this.img,(this.screenWidth-this.img.width)/2,(this.screenHeight-this.img.height)/2)}update(){}}class E{constructor(t,e,i){this.img=t,this.width=e,this.height=i,this.isPlaying=!1,this.loop=!1,this.interval=1e3/60,this.index=0,this.count=3,this.imgList=[],this.frameInterval=6,this.curInterval=0}aniRender(t){t.drawImage(this.imgList[this.index],this.x,this.y,1*this.width,1*this.height),0==this.curInterval?(this.index++,this.index>=this.imgList.length&&(this.index=0),this.curInterval=this.frameInterval):this.curInterval-=1}}let _=null;const P=[a.redbird_downflap,a.redbird_midflap,a.redbird_upflap],I=P[0],T=34,S=24,H=20,W=new class{constructor(){if(_)return _;_=this}playDie(){a.audioDie.play()}playHit(){a.audioHit.play()}playPoint(){a.audioPoint.play()}playSwoosh(){a.audioSwoosh.play()}playWing(){a.audioWing.play()}};class A extends E{constructor(t){super(I,T,S),this.scene=t,this.height=S,this.imgList=P,this.screenWidth=t.canvas.width,this.screenHeight=t.canvas.height,this.x=this.screenWidth/2,this.y=this.screenHeight/2,this.ySpeed=1,this.jumpSpeed=10,this.g=1,this.birdAngle=0,this.frameInterval=2,this.curInterval=0}render(){const t=this.scene.ctx;this.ySpeed<0?this.birdAngle=-H:this.ySpeed>0?this.birdAngle=H:this.birdAngle=0,this.birdAngle=this.birdAngle*Math.PI/180,t.translate(this.x+T/2,this.y+S/2),t.rotate(this.birdAngle);const e=this.x,i=this.y;this.x=-T/2,this.y=-S/2,this.aniRender(t),this.x=e,this.y=i,t.setTransform(1,0,0,1,0,0)}update(){0==this.curInterval?(function(){this.y+=this.ySpeed,this.ySpeed+=this.g}.bind(this)(),this.curInterval=this.frameInterval):this.curInterval-=1}jump(){this.ySpeed=-this.jumpSpeed,W.playWing()}}var M={isCollide:function(t,e){let i=e.x+e.width/2,s=e.y+e.height/2;return!!(i>=t.x&&i<=t.x+t.width&&s>=t.y&&s<=t.y+t.height)},convertNumToImg:function(t){const e="https://lg-ifkf8f9o-1257111143.cos.ap-shanghai.myqcloud.com/",i=[];for(;t>9;){const s=new Image;s.src=e+"assets/sprites/"+t%10+".png",i.unshift(s),t=Math.floor(t/10)}const s=new Image;return s.src=e+"assets/sprites/"+t%10+".png",i.unshift(s),i}};a.pipe_green;const j=52,L=o.PIPE_SPACE_HEIGHT,O=o.PIPE_SPACE_WIDTH,k=o.PIPE_MIN_HEIGHT,D=o.PIPE_MAX_HEIGHT;class R{constructor(t){this.img=a.pipe_green,this.scene=t,this.screenWidth=t.canvas.width,this.screenHeight=t.canvas.height,this.left=this.screenWidth,this.speed=o.PIEP_SPEED_X,this.lastPassedPipe=null,this.positions=[],this.initPositions()}update(){if(this.left-=this.speed,this.left<=-j){const t=this.positions.length-1;this.positions=this.positions.slice(2);const e=k+Math.random()*(D-k);this.positions.push({x:this.left+t*(j+O),y:e,width:this.img.width,height:this.screenHeight-e,isRotate:!1}),this.positions.push({x:this.left+t*(j+O),y:0,width:this.img.width,height:e-L,isRotate:!0}),this.left=this.left+O+this.img.width}this.updatePositions()}initPositions(){const t=this.img.complete,e=this,i=(this.screenHeight,this.screenWidth);function s(){const t=e.img.width,s=Math.ceil((i+O)/(t+O));for(let i=0;i<s;i++){const s=k+Math.random()*(D-k);e.positions.push({x:e.left+i*(t+O),y:s,width:e.img.width,height:e.screenHeight-s,isRotate:!1}),e.positions.push({x:e.left+i*(t+O),y:0,width:e.img.width,height:s-L,isRotate:!0})}}this.positions=[],t?s():this.img.onload=(()=>{s()})}updatePositions(){this.positions.forEach((t,e)=>{t.x=e%2==0?this.left+e/2*(j+O):this.left+Math.floor(e/2)*(j+O)})}render(){const t=this.scene.ctx;this.positions.forEach(e=>{e.isRotate?(t.translate(this.screenWidth/2,this.screenHeight/2),t.rotate(Math.PI),t.drawImage(this.img,this.screenWidth/2-e.x-e.width,this.screenHeight/2-e.height),t.setTransform(1,0,0,1,0,0)):t.drawImage(this.img,e.x,e.y)})}isCollideWidthBird(t){return this.positions.some(e=>M.isCollide(e,t))}isPassBird(t){const e=this.positions.filter(e=>e.x+e.width<=t.x).pop();return!(!e||e===this.lastPassedPipe)&&(this.lastPassedPipe=e,!0)}}const X=236;class C{constructor(t){this.img=a.scoreboard,this.ctx=t.ctx,this.screenWidth=t.canvas.width,this.width=X,this.x=(this.screenWidth-X)/2,this.y=o.OVER_TITLE_Y}update(){}render(){this.ctx.drawImage(this.img,this.x,this.y)}}const B=24;class G{constructor(t){this.game=t,this.score=0,this.ctx=t.ctx,this.screenWidth=t.canvas.width,this.y=o.SCORE_Y}render(){this.imgList=M.convertNumToImg(this.game.getScore());const t=this.imgList.length*B;this.x=(this.screenWidth-t)/2;for(let t=0;t<this.imgList.length;t++)this.ctx.drawImage(this.imgList[t],this.x+t*B,this.y)}update(){}setPosition(t,e){this.x=t,this.y=e}}class Y extends s{constructor(t){super(t),this.overTitle=new C(this);const e=new g(this),i=new v(this);this.ctx=t.ctx,this.screenWidth=t.canvas.width,this.addElements(e),this.addElements(i),this.addElements(this.overTitle),this.bindTouch=this.handleTouchStart.bind(this),this.initEvents()}initEvents(){this.canvas.onclick=this.bindTouch}render(){super.render(),this.renderScore(),this.renderMedal()}renderScore(){const t=this.game.getScore(),e=M.convertNumToImg(t);this.ctx.scale(25/36,25/36),e.forEach((t,e)=>{const i=((this.screenWidth-this.overTitle.width)/2+166+e*t.width)/(25/36),s=(this.overTitle.y+100)/(25/36);this.ctx.drawImage(t,i,s)}),this.ctx.setTransform(1,0,0,1,0,0)}renderMedal(){const t=this.game.getScore();let e=null;e=t<100?a.medal_bronze:t<200?a.medal_silver:t<300?a.medal_gold:a.medal_platinum,this.ctx.drawImage(e,(this.screenWidth-this.overTitle.width)/2+33,this.overTitle.y+115)}handleTouchStart(t){const e=new $(this.game);this.game.replaceScene(e)}update(){}}let N=null;class q{constructor(){if(N)return N;N=this}playDie(){a.audioDie.play()}playHit(){a.audioHit.play()}playPoint(){a.audioPoint.play()}playSwoosh(){a.audioSwoosh.play()}playWing(){a.audioWing.play()}}const z=new q,F=112;class V extends s{constructor(t){super(t),this.bindTouch=this.touchHandler.bind(this),this.screenHeight=t.canvas.height,this.initElements(),this.initEvents()}initElements(){const t=new g(this),e=new v(this);this.bird=new A(this),this.pipe=new R(this);const i=new G(this.game);this.addElements(t),this.addElements(this.pipe),this.addElements(e),this.addElements(i),this.addElements(this.bird)}initEvents(){this.canvas.onclick=this.bindTouch}touchHandler(t){this.bird.jump()}update(t){if(super.update(t),this.bird.y+this.bird.height>this.screenHeight-F||this.pipe.isCollideWidthBird(this.bird)){z.playHit();const t=new Y(this.game);this.game.replaceScene(t)}this.pipe.isPassBird(this.bird)&&this.game.increaseScore()}}class $ extends s{constructor(t){super(t),this.initElements(),this.initEvents()}initElements(){const t=new g(this),e=new v(this);this.startBtn=new x(this),this.addElements(t),this.addElements(e),this.addElements(this.startBtn)}initEvents(){this.bindTouch=this.touchHandler.bind(this),this.canvas.onclick=this.bindTouch}touchHandler(t){let e=t.layerX,i=t.layerY,s=this.startBtn.btnArea;if(e>=s.startX&&e<=s.endX&&i>=s.startY&&i<=s.endY){const t=new V(this.game);this.game.replaceScene(t),this.game.score=0}}}const J=new q;new class{constructor(t){this.score=0,this.canvas=t,this.ctx=t.getContext("2d"),this.scene=new $(this),this.run()}render(){this.scene.render()}update(){this.scene.update()}increaseScore(){this.score+=2,J.playPoint(),console.log("score: ",this.score)}getScore(){return this.score}run(){const t=this;window.requestAnimationFrame(function e(){t.render(),t.update(),window.requestAnimationFrame(e)})}replaceScene(t){this.scene=t}}(document.querySelector("#game"))}]);